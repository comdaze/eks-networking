提案：CNI插件用于AWS VPC上的Kubernetes网络。
背景

Kubernetes规定了以下基本要求。

所有的容器都可以在没有NAT的情况下与所有其他容器通信
所有节点可以与所有容器进行通信（反之亦然），无需NAT。
容器把自己看成的IP地址和别人看成的IP地址是一样的。
为了在AWS VPC上运行Kubernetes，我们希望达到以下附加目标。

Pods的网络必须支持高吞吐量和可用性，低延迟和最小的抖动，与用户从EC2网络中获得的特性相当。
用户必须能够表达和执行细粒度的网络策略和隔离，与原生EC2网络和安全组实现的网络策略和隔离相当。
网络操作必须简单且安全。用户必须能够应用现有的AWS VPC网络和安全最佳实践，在AWS VPC上构建Kubernetes集群。例如，用户应该能够。
使用VPC流量日志进行故障排除和合规性审计。
应用VPC路由策略进行流量工程。
应用安全组来强制隔离并满足监管要求。
应在几秒钟内完成Pod网络的设置。
管理员应该能够将集群扩展到2000个节点。

在这里我们提出。

对于每个Kubernetes节点（ec2实例），创建多个弹性网络接口（ENI），并分配其二级IP地址。
对于每个pod，挑选一个空闲的二级IP地址，将其分配给pod，线主机和pod网络栈，以允许。
Pod与Pod在一台主机上的通信
不同主机上的Pod to Pod通信
Pod与其他AWS服务的通信
Pod到内部数据中心的通信
Pod到互联网的通信
在EC2-VPC中，每个实例可以有多个弹性网络接口（ENI），每个ENI可以有多个IPv4或IPv6地址。任何指向这些地址之一的数据包，EC2-VPC Fabric都会将数据包传送到实例中。

弹性网络接口是一个虚拟网络接口，您可以将其附加到VPC中的实例上。当ENI连接到实例时，就会创建一个相应的接口。主要的ENI IP地址会自动分配给接口。所有的次要地址仍未分配，如何配置由主机所有者决定。

有多少地址可用？
当您创建VPC时，您必须以无类域间路由(CIDR)块的形式为VPC指定一个IPv4地址范围，例如，10.0.0.0/16。这是您 VPC 的主要 CIDR 块。

一个 VPC 跨越该区域的所有可用性区。创建 VPC 后，您可以在每个可用性区中添加一个或多个子网。创建子网时，您需要指定子网的 CIDR 块，它是 VPC CIDR 块的子集。每个子网必须完全驻留在一个可用区中，不能跨区。可用性区是不同的位置，设计成与其他可用性区的故障隔离。通过在不同的可用区中启动实例，您可以保护您的应用程序免受单个位置的故障影响。我们为每个子网分配了一个唯一的 ID。

创建 ENI 时，您必须指定子网。根据实例类型（Limit），每个实例最多可以有N个ENI和M个地址。每个ENI上的一个地址总是被标记为主地址，而其他地址则是次地址。主IP地址不被任何Pods使用，因为它是Pods和外部世界之间的流量路由所需。

每一个EC2实例上的Pods可用的最大IP地址数量可以计算为。

最大IPs = min((N * M - N), 子网的空闲IP)

